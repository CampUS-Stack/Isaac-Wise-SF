<!--
 - Created by Chris Home Desktop on 6/14/2017.
 -->

<apex:page id="ClassRoster_Edit" standardController="Class__c" extensions="ClassRoster_EditController" sideBar="true">

    <apex:includeScript value="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js" />
    <apex:form id="theForm">
        <apex:actionFunction reRender="theForm" name="rerenderForm" />
        <apex:pageBlock title="Class Roster Wizard" id="classPageBlock">
            <apex:pageBlockButtons location="top">
                <apex:commandButton action="{!ShowAddStudentSection}" reRender="rosterDisplayArea" value="Add Student"/>
                <!--<apex:commandButton action="/apex/ClassRoster_Copy?id={!$CurrentPage.parameters.id}&retURl={!$CurrentPage.URL}" value="Copy Another Class Roster"/>-->
                <apex:commandButton action="/{!Class__c.Id}" reRender="rosterDisplayArea" value="Back to Class"/>
            </apex:pageBlockButtons>
            <apex:pageBlockSection columns="2">
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Class Name" for="className" />
                    <apex:outputField id="gradeLevel" value="{!Class__c.Name}" />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Grade Level" for="gradeLevel" />
                    <apex:outputField id="gradeLevel" value="{!Class__c.Grade_Level__c}" />
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>
        </apex:pageBlock>
        <apex:outputPanel id="rosterDisplayArea">
            <apex:outputPanel rendered="{!displayAddStudent}">
                <table width="100%">
                    <col width="61%"/>
                    <col width="39%"/>
                    <tr>
                        <td style="vertical-align:top;">
                            <apex:pageBlock id="theBlock" >
                                <apex:pageBlockButtons location="top">
                                    <apex:commandButton id="addStudentSearchBtn" value="Search" action="{!SearchForStudents}" reRender="theBlock,theBlock2"/>
                                    <!--<apex:commandButton value="Clear" onclick="window.location.reload();" reRender="theBlock,theBlock2"/>-->
                                    <apex:commandButton value="Clear" action="{!ClearAddSutdentForm}" reRender="theBlock,theBlock2"/>
                                    <apex:commandButton value="View Roster" onclick="window.location.reload();" reRender="theBlock,theBlock2"/>
                                </apex:pageBlockButtons>
                                <apex:pageBlockSection columns="2">
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel value="Student Name" for="className" />
                                        <apex:inputField id="studentName" value="{!dummyClass.Name}" onKeyPress="checkForEnterKey(event);"/>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel value="Class" for="class" />
                                        <apex:inputField id="class" value="{!dummyClass.Parent_Class__c}" onKeyPress="checkForEnterKey(event);"/>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel value="Age" for="gradeLevel" />
                                        <apex:inputText id="age" value="{!Age}" onKeyPress="checkForEnterKey(event);"/>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel value="Grade Level" for="gradeLevel" />
                                        <apex:inputField id="dateOfBirth" value="{!dummyClass.Grade_Level__c}" onKeyPress="checkForEnterKey(event);"/>
                                    </apex:pageBlockSectionItem>
                                    <apex:outputPanel >
                                        <apex:outputLabel value="Exclude Students from Sibling Classes" for="siblingClassCriteria" />
                                        <apex:inputCheckbox id="siblingClassCriteria" value="{!AddSiblingClassCriteria}" onKeyPress="checkForEnterKey(event);"/>
                                    </apex:outputPanel>
                                </apex:pageBlockSection>
                                <apex:pageBlockSection title="All Students" columns="1">

                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel value=""  />
                                        <apex:commandButton onclick="var r = confirm('Are you sure you want to enroll all selected students in {!JSINHTMLENCODE(Class__c.Name)}?'); if(r == false){return false}" id="addStudentBtn" value="Add Students" action="{!AddSelectedStudent}" reRender="theBlock,theBlock2"/>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockTable width="100%" value="{!students}" var="studentwrap">
                                        <apex:column >
                                            <apex:facet name="header">
                                                <apex:commandLink value="Select All" action="{!SelectAllStudents}"  reRender="theBlock,theBlock2">
                                                    <apex:param name="theParam" assignTo="{!StudentIdToAdd}" value="{!studentwrap.student.Id}" />
                                                </apex:commandLink>
                                            </apex:facet>
                                            <apex:inputCheckbox styleClass="studentCheckbox" value="{!studentwrap.isSelected}"/>
                                        </apex:column>
                                        <apex:column value="{!studentwrap.student.LastName}" >
                                            <apex:facet name="header">
                                                <apex:commandLink style="color:black;" action="{!changeSortColumn}" value="Last Name   {!IF(selectedField=='LastName',IF(selectedSortOrder=='DESC','▼','▲'),'')}">
                                                    <apex:param value="LastName" name="column" assignTo="{!selectedField}" ></apex:param>
                                                </apex:commandLink>
                                            </apex:facet>
                                        </apex:column>
                                        <apex:column value="{!studentwrap.student.FirstName}" >
                                            <apex:facet name="header">
                                                <apex:commandLink style="color:black;" action="{!changeSortColumn}" value="First Name   {!IF(selectedField=='FirstName',IF(selectedSortOrder=='DESC','▼','▲'),'')}">
                                                    <apex:param value="FirstName" name="column" assignTo="{!selectedField}" ></apex:param>
                                                </apex:commandLink>
                                            </apex:facet>
                                        </apex:column>
                                        <apex:column value="{!studentwrap.student.Is_Current_Member__c}" />
                                        <apex:column value="{!studentwrap.student.Nickname__c}" />
                                        <apex:column value="{!studentwrap.student.MailingStreet}" />
                                        <apex:column value="{!studentwrap.student.MailingCity}" />
                                    </apex:pageBlockTable>
                                </apex:pageBlockSection>
                            </apex:pageBlock>
                        </td>
                        <td style="vertical-align:top;">
                            <apex:pageBlock id="theBlock2" >
                                <apex:pageBlockSection title="Currently Enrolled" columns="1">
                                    <apex:pageBlockTable width="100%"  value="{!enrolledStudents}" var="studentwrap">
                                        <!--<apex:column width="6%" headerValue="Action">-->
                                        <!--<apex:commandButton value="Remove" action="{!RemoveStudent}" reRender="theBlock,theBlock2" onComplete="classPageBlock">-->
                                        <!--<apex:param name="theParam" assignTo="{!StudentIdToRemove}" value="{!studentwrap.student.Id}" />-->
                                        <!--</apex:commandButton>-->
                                        <!--</apex:column>-->
                                        <apex:column value="{!studentwrap.student.FirstName}" />
                                        <apex:column value="{!studentwrap.student.LastName}" />
                                        <apex:column value="{!studentwrap.student.Is_Current_Member__c}" />
                                        <apex:column value="{!studentwrap.student.Nickname__c}" />
                                        <apex:column value="{!studentwrap.student.MailingStreet}" />
                                        <apex:column value="{!studentwrap.student.MailingCity}" />
                                    </apex:pageBlockTable>
                                </apex:pageBlockSection>
                            </apex:pageBlock>
                        </td>
                    </tr>
                </table>
            </apex:outputPanel>
            <apex:outputPanel rendered="{!NOT(displayAddStudent)}">
                <apex:pageBlock id="maincurrentEnrolledBlock">
                    <apex:pageBlockSection title="All Students" columns="1">
                        <apex:pageBlockTable width="100%" value="{!enrolledStudents}" var="studentwrap">
                            <apex:column width="5%" headerValue="Action">
                                <apex:commandButton value="Un-Enroll" onclick="var r = confirm('Are you sure you want to drop {!studentwrap.student.Name} out of {!Class__c.Name}?'); if(r == false){return false}" action="{!RemoveStudent}"  reRender="maincurrentEnrolledBlock">
                                    <apex:param name="theParam" assignTo="{!StudentIdToRemove}" value="{!studentwrap.student.Id}" />
                                </apex:commandButton>
                            </apex:column>
                            <apex:column value="{!studentwrap.student.FirstName}" />
                            <apex:column value="{!studentwrap.student.LastName}" />
                            <apex:column value="{!studentwrap.student.Is_Current_Member__c}" />
                            <apex:column value="{!studentwrap.student.Nickname__c}" />
                            <apex:column value="{!studentwrap.student.MailingStreet}" />
                            <apex:column value="{!studentwrap.student.MailingCity}" />
                        </apex:pageBlockTable>
                    </apex:pageBlockSection>
                </apex:pageBlock>
            </apex:outputPanel>
        </apex:outputPanel>
        <apex:actionFunction name="reRenderDisplayArea" reRender="rosterDisplayArea,theBlock,theBlock2" />
        <script>

            $j = jQuery.noConflict();

            $j(document).ready(function() {

            });

            function checkForEnterKey(e){
                console.log('Click found. ' + e.keyCode + ' ' + e.ctrlKey);
                if (e.keyCode==13){
                    console.log('Enter Key found.');
                    $j('[id$=addStudentSearchBtn]').trigger('click');
                }
            }

        </script>
    </apex:form>
</apex:page>